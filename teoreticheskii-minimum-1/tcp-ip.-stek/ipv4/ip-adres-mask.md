# IP адрес, mask

> Кратко: IP-адрес состоит из сетевой и хостовой части. Маска (или префикс) указывает, какие биты адреса относятся к сети. По маске вычисляют адрес сети и broadcast.

### Определения

* **IP-адрес (IPv4)** — 32-битное число, обычно в десятичном точечном виде: `a.b.c.d`.
* **Маска сети** задаёт, сколько старших бит относятся к сети. Формат: `255.255.255.0` или префикс `/24`.
* **Префикс** — число бит сети $$/n$$, где $$0\le n\le 32$$.

### Разделение на сеть и хост

* Сетевая часть = старшие $$n$$ бит адреса.
* Хостовая часть = оставшиеся $$32-n$$ бита.

Если представить в двоичном виде:

```
IP = [ network_bits (n) | host_bits (32-n) ]
```

### Вычисления (алгоритм)

1. Преобразовать IP и маску в двоичный вид.
2. Адрес сети = IP AND маска.
3. Broadcast = адрес сети OR (битовая инверсия маски).
4. Первый доступный хост = сеть + 1 (если не /31/ /32).
5. Последний доступный хост = broadcast − 1.
6. Количество возможных хостов: $$\text{hosts} = 2^{32-n}-2$$ (исключая адрес сети и broadcast; исключения: `/31` — 2 адреса используются для p2p по RFC3021, `/32` — одиночный адрес).

### Примеры

#### Пример 1

IP `192.168.10.130/26`.

* Маска `/26` = `255.255.255.192`.
* Размер хостовой части $$32-26=6$$.
* Количество хостов $$2^6-2=64-2=62$$.
* Блок размера 64: сети начинаются с `.0, .64, .128, .192`. IP `192.168.10.130` попадает в блок `192.168.10.128/26`.
* Адрес сети: `192.168.10.128`.
* Broadcast: `192.168.10.191`.
* Доступные хосты: `192.168.10.129` — `192.168.10.190`.

#### Пример 2 (/24)

IP `10.0.5.17/24` → сеть `10.0.5.0`, broadcast `10.0.5.255`, hosts `254` ( $$2^{8}-2$$ ).

### Часто используемые маски и sizes

<table><thead><tr><th width="131.00994873046875" align="right">Префикс</th><th align="center">Маска</th><th align="right">Кол-во хостов</th></tr></thead><tbody><tr><td align="right">/24</td><td align="center">255.255.255.0</td><td align="right"><span class="math">2^8-2=254</span></td></tr><tr><td align="right">/25</td><td align="center">255.255.255.128</td><td align="right"><span class="math">2^7-2=126</span></td></tr><tr><td align="right">/26</td><td align="center">255.255.255.192</td><td align="right"><span class="math">62</span></td></tr><tr><td align="right">/30</td><td align="center">255.255.255.252</td><td align="right"><span class="math">2</span> (обычно p2p: 2 usable)</td></tr><tr><td align="right">/31</td><td align="center">255.255.255.254</td><td align="right"><span class="math">2</span> (RFC3021 — point-to-point)</td></tr><tr><td align="right">/32</td><td align="center">255.255.255.255</td><td align="right"><span class="math">1</span> (single host)</td></tr></tbody></table>

### Специальные и зарезервированные адреса

* `0.0.0.0/8` — источник при инициализации.
* `127.0.0.0/8` — loopback (обычно `127.0.0.1`).
* `169.254.0.0/16` — link-local (APIPA).
* Частные сети (RFC1918):
  * `10.0.0.0/8`
  * `172.16.0.0/12`
  * `192.168.0.0/16`
* `255.255.255.255` — limited broadcast.

### CIDR и агрегация

* CIDR позволяет объединять префиксы для сокращения таблиц маршрутизации.
* Правило агрегации: сети с соседними префиксами можно объединить если их адреса выровнены по размеру блока (network address совпадает для объединённого префикса).

### Практические команды

* Быстро посчитать сеть/broadcast: `ipcalc 192.168.10.130/26` (Linux).
* Просмотр адресов интерфейса: `ip addr show`.
* Добавить адрес: `ip addr add 192.168.10.130/26 dev eth0`.

### Экзаменационные тезисы

1. Маска `/n` отсекает первые $$n$$ бит как сеть.
2. Адрес сети = IP AND маска. Broadcast = сеть OR (\~маска).
3. Количество хостов = $$2^{32-n}-2$$ (исключая сеть и broadcast; учитывать исключения для /31, /32).
4. Частные диапазоны: `10/8`, `172.16/12`, `192.168/16`.

### Вопросы для самопроверки

1. Вычислите сеть и broadcast для `172.16.5.200/29`.
2. Сколько хостов доступно в `192.168.0.0/22`?
3. Почему `255.255.255.255` не может быть адресом хоста?
