# Адрес DNS

> Кратко: DNS переводит доменные имена в IP-адреса и обратно. Состоит из иерархии серверов и разных типов запросов (recursive/iterative).

### Что такое DNS

* DNS = система доменных имён.
* Назначение: человеко-читаемые имена → машинные адреса (A, AAAA) и другие записи.
* Работа поверх UDP/TCP порт $$53$$.

### Основные типы записей

* **A** — IPv4 адрес.
* **AAAA** — IPv6 адрес.
* **CNAME** — каноническое имя (alias).
* **MX** — почтовый обменник.
* **NS** — авторитетный сервер зоны.
* **PTR** — обратная запись (IP → имя).
* **SOA** — стартовая запись зоны (сервер, админ, serial, refresh, retry, expire, ttl).
* **TXT** — произвольный текст (SPF, DKIM и т.п.).
* **SRV** — сервисные записи (службы с приоритетом/портом).

### Процесс разрешения имени (упрощённо)

1. Клиент спрашивает локальный resolver (обычно OS → stub resolver).
2. Stub отправляет recursive query к рекурсивному резолверу (ISP / корпоративный / 8.8.8.8).
3. Рекурсивный резолвер делает iterative запросы по иерархии: root → TLD → authoritative.
4. Рекурсивный резолвер возвращает ответ клиенту и кеширует результат на TTL.

### Роли

* **Stub resolver** — в ОС; посылает запрос рекурсивному резолверу.
* **Recursive resolver** — делает всю работу по поиску ответа; кеширует.
* **Authoritative server** — владеет зоной и даёт окончательный ответ для неё.
* **Forwarder** — пересылает запросы на другой резолвер.

### Кеширование и TTL

* Каждая запись имеет **TTL**. Пока TTL не истёк, рекурсивный резолвер отдаёт кешированный ответ.
* Изменение зоны проявляется у клиентов после истечения TTL или инвалидации кеша.

### Рекурсивный vs Итеративный

* **Рекурсивный**: резолвер гарантирует ответ клиенту, делая все подзапросы.
* **Итеративный**: сервер отвечает ссылкой на следующий сервер (NS) и клиент/резолвер продолжает.

### Резервирование и отказоустойчивость

* Для зоны указывают несколько NS. Клиент/резолвер выбирает доступный.
* Для корпоративной сети используют локальный рекурсивный резолвер и forwarders.

### Безопасность

* **DNSSEC** — подпись записей для гарантии целостности и подлинности.
* Уязвимости: кеш-подмена, amplification DDoS (в т.ч. через open resolvers).
* Практика: запрет открытых рекурсивных резолверов, rate limiting, ответственный TTL.

### Инструменты для диагностики

* `dig example.com A` — детальный запрос и цепочка ответов.
* `dig +trace example.com` — показывает итеративный обход от root.
* `nslookup`, `host` — быстрые проверки.
* Проверка reverse: `dig -x 1.2.3.4`.

### Практические советы

* Для быстрой отладки используйте `dig @resolver example.com`.
* Для стабильности указывайте минимум 2 NS и разные сети.
* Для динамических сред уменьшайте TTL при подготовке к изменению, затем увеличьте.

### Экзаменационные тезисы

1. DNS переводит имена в IP и обратно.
2. Порт DNS — $$53$$ (UDP для запросов, TCP для зон/больших ответов/AXFR).
3. Рекурсивный резолвер кеширует ответы на TTL.
4. SOA содержит serial и таймеры зоны.
5. DNSSEC защищает данные подписью.

### Вопросы для самопроверки

1. Чем отличается A от CNAME?
2. Как работает `dig +trace`?
3. Почему open recursive resolver — опасен?
