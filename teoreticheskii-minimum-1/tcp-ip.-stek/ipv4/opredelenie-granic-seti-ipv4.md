---
description: по адресу и маске
---

# Определение границ сети IPv4

Кратко: границы сети вычисляются побитовой операцией AND между IP и маской; broadcast — побитовое OR сети и инверсии маски. По этим вычислениям получают адрес сети, broadcast, первый/последний хост и число доступных хостов.

***

### Формулы

$$\text{network} = \text{IP};\&; \text{mask}$$ $$\text{broadcast} = \text{network} ;|; (\sim\text{mask} \& 0xFFFFFFFF)$$ $$\text{hosts_count} = 2^{32-n}-2$$ (обычно) где $$n$$ — длина префикса `/n`. Исключения: `/31` (RFC3021) и `/32`.

***

### Алгоритм шаг-за-шаг

1. Перевести IP и маску в 32-битное двоичное представление или работать по октетам.
2. Выполнить побитовое AND → получить адрес сети.
3. Инвертировать маску (битовое NOT) и выполнить OR с адресом сети → получить broadcast.
4. Первый хост = network + 1 (если не `/31`/`/32`). Последний хост = broadcast − 1.
5. Число адресов в блоке = $$2^{32-n}$$. Количество usable = $$2^{32-n}-2$$ (обычно).

***

### Быстрые приёмы (практика без двоичных вычислений)

* Размер блока в байтах в последнем значимом октете: $$\text{block_size} = 2^{8 - (n \bmod 8)}$$ (если $$n\bmod8=0$$, смотреть предыдущий октет).
* Инкремент (шаг сетей) в том октете = $$256 - \text{mask_octet}$$.
* Чтобы найти начало блока: делите значение соответствующего октета на block\_size, отбрасываете дробную часть, умножаете обратно на block\_size.

***

### Примеры (пошагово, с битами)

#### Пример A — `192.168.10.130/26`

* Маска `/26` = `255.255.255.192`. Последний октет маски = `192` = `11000000₂`.
* IP последний октет `130` = `10000010₂`.
* Network last octet: `10000010₂ & 11000000₂ = 10000000₂` → `128`.
* Network = `192.168.10.128`.
* Wildcard (инверсия маски) в последнем октете = `00111111₂` = `63`.
* Broadcast last octet = `128 | 63 = 191`.
* Broadcast = `192.168.10.191`.
* Usable хосты: `192.168.10.129` … `192.168.10.190`. Всего `2^{6}-2=62` usable.

#### Пример B — `172.16.5.200/29`

* Маска `/29` = `255.255.255.248`. Последний октет маски = `248` = `11111000₂`.
* IP последний октет `200` = `11001000₂`. AND → `11001000₂` = `200`.
* Network = `172.16.5.200`.
* Broadcast = `172.16.5.200 | 0b00000111 = 207`.
* Usable: `172.16.5.201` … `172.16.5.206`. Всего `2^{3}-2=6`.

#### Пример C — `10.0.5.17/20` (маска пересекает октет)

* `/20` → маска `255.255.240.0`. Третий октет маски = `240` = `11110000₂`.
* Третий октет IP = `5` = `00000101₂`. AND → `00000000₂` = `0`.
* Network = `10.0.0.0/20`. Broadcast = `10.0.15.255`.
* Usable хосты: `10.0.0.1` … `10.0.15.254`. Всего `2^{12}-2=4094`.

***

### Правила и исключения

* `/31` — используется для p2p, имеет 2 адреса, оба назначаемы (RFC3021).
* `/32` — одиночный адрес (host route).
* Не назначайте адрес сети и broadcast как адреса хоста (классическое правило для /30 и т.д.).

***

### Быстрые команды (Linux)

* `ipcalc 192.168.10.130/26` — быстрый вывод (если установлен).
* `sipcalc 172.16.5.200/29` — альтернатива.
*   Проверка адреса/маршрута:

    ```bash
    ip route get 192.168.10.130
    ```
*   Простая проверка IP vs сеть в shell (пример):

    ```bash
    # вывести network (пример с ipcalc предпочтительнее)
    ```

***

### Экзаменационные тезисы

1. Network = IP & mask; Broadcast = network | \~mask.
2. Количество адресов в блоке = $$2^{32-n}$$. Usable обычно = $$2^{32-n}-2$$.
3. Блоки выровнены по границе размера блока (например, /26 блоки в последнем октете начинаются с 0,64,128,192).
4. Для вычислений достаточно смотреть на тот октет, в котором заканчивается префикс, и применять block\_size.

***

### Самопроверка

1. Найдите network и broadcast для `192.0.2.45/27`.
2. Сколько usable адресов в `10.0.0.0/22` и каков broadcast?
3. Почему `192.168.1.0/24` и `192.168.0.0/23` — разные сети?

(Если хотите, решу эти примеры прямо сейчас и покажу двоичные расчёты.)
