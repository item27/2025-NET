---
description: IP-шлюз
---

# IP-Gate

> Кратко: шлюз по умолчанию — маршрут для пакетов, у которых нет более конкретного пути в таблице маршрутизации. Обычно это интерфейс/адрес маршрутизатора в локальной подсети.

### Назначение

* Обеспечивает выход в другие подсети и в Интернет.
* Обрабатывает пакеты с целью доставки за пределы локальной сети, когда нет подходящего маршрута.

### Как это работает (по шагам)

1. Хост хочет отправить пакет к адресу, лежащему вне своей сети.
2. Хост вычисляет: есть ли в таблице маршрут для целевого префикса. Если нет — используется маршрут по умолчанию $$0.0.0.0/0$$.
3. Пакет инкапсулируется в L2-кадр с MAC-адресом шлюза (ARP разрешение).
4. Шлюз принимает пакет и выполняет маршрутизацию дальше по своей таблице.

### Формальное представление

*   Маршрут по умолчанию обозначается как:

    $$
    \text{destination} = 0.0.0.0/0,\quad \text{next-hop} = \text{IP_gateway}
    $$

### Примеры команд и вывод

* Показать таблицу маршрутизации:

```bash
ip route show
# пример строки: default via 192.168.1.1 dev eth0 proto dhcp metric 100
```

* Проверить ARP на шлюз:

```bash
ip neigh show
# или: arp -n
```

### Поведение при проблемах

* Если шлюз недоступен (нет ARP/нет link) → пакеты теряются, появляется unreachable.
* Если в сети несколько шлюзов, можно использовать:
  * статические маршруты с разными следующими хопами;
  * маршрутизацию по умолчанию с высокой доступностью (VRRP/HSRP/GLBP) на стороне маршрутизаторов;
  * на хосте — несколько маршрутов с разными метриками.

### Отличие маршрута по умолчанию и статического маршрута

* **Статический маршрут** фиксирует путь к конкретному префиксу (например, `10.0.0.0/8 via 192.168.1.2`).
* **Default** покрывает все адреса, не подпавшие под более конкретные правила.

### Практические советы

*   На клиенте обычно устанавливается шлюз через DHCP или вручную:

    ```bash
    ip route add default via 192.168.1.1 dev eth0
    ```
* Проверяйте, что шлюз и клиент в одной L2-сети и что ARP возвращает корректный MAC.
* Для резервирования используйте протоколы уровня маршрутизаторов (VRRP/HSRP) или на хосте несколько default с разными метриками.

### Экзаменационные тезисы

1. Default = $$0.0.0.0/0$$ → используется при отсутствии более конкретного маршрута.
2. Хост присылает кадры на MAC шлюза через ARP.
3. Шлюз маршрутизирует дальше по своей таблице.
4. Резервирование шлюза делается средствами маршрутизаторов (VRRP/HSRP) или на хосте несколькими маршрутами.

### Вопросы для самопроверки

1. Что произойдёт, если в таблице маршрутизации есть конкретный маршрут и маршрут по умолчанию?
2. Как проверить, какой MAC соответствует IP-шлюзу?
3. Как настроить два default-шлюза с разными приоритетами на Linux?
