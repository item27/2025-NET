---
description: назначение, возможности
---

# vnStat

> Кратко: **vnStat** — лёгкий демонический сборщик и хранитель трафиковых счётчиков интерфейсов. Не делает захват пакетов. Низкая нагрузка. Хорош для долгосрочной статистики по интерфейсам.

### Что делает

* Считывает системные счётчики (из ядра) и сохраняет их в собственную базу.
* Хранит историю по минутам/часам/суткам/месяцам.
* Даёт текстовые/графические отчёты и JSON-вывод.
* Подходит для мониторинга полосы на длительных интервалах (hour/day/month).

### Отличие от `iftop`/`bmon`

* `vnStat` — **агрегатор исторических данных**, не показывает per-connection и не даёт live per-flow анализа.
* `iftop`/`bmon` — live, per-connection/интерфейс. `vnStat` — накопление и отчёты.

### Установка и запуск

```bash
# Debian/Ubuntu
sudo apt install vnstat

# RHEL/CentOS (пример)
sudo yum install vnstat

# Инициализация БД для интерфейса (пример)
sudo vnstat --create -i enp0s3   # или: vnstat -u -i enp0s3

# Запустить/включить демон
sudo systemctl enable --now vnstat
```

(путь БД обычно `/var/lib/vnstat/`).

### Основные команды (быстро)

```bash
# показать сводку по интерфейсу
vnstat -i enp0s3

# почасовая статистика
vnstat -i enp0s3 -h

# суточная статистика
vnstat -i enp0s3 -d

# месячная статистика
vnstat -i enp0s3 -m

# графики ASCII (в интерактиве)
vnstat -i enp0s3 -g

# live-mode (показывает текущий throughput)
vnstat -i enp0s3 -l

# вывести в JSON (интеграции)
vnstat --json -i enp0s3

# удалить/сбросить БД (внимательно)
sudo vnstat --remove -i enp0s3   # проверьте man перед выполнением
```

### Формат и частота

* Демон опрашивает счётчики ядра с низкой частотой, поэтому нагрузка минимальна.
* БД хранит агрегаты; точность на уровне счётчиков ядра.
* Поддерживает IPv4 и IPv6 счётчики отдельно.

### Где хранится и как бэкапить

* БД: обычно `/var/lib/vnstat/` (файлы per-interface).
* Бэкап просто копированием этих файлов. При восстановлении перезапустите сервис.

### Ограничения и нюансы

* Не показывает per-connection/flow.
* Если интерфейс меняет имя, потребуется создать новую БД.
* Счётчики зависят от ядра; при перезагрузке NIC счётчики могут сбрасываться, но vnStat хранит исторические значения корректно, если демон корректно запущен.
* Для точности синхронизируйте часовой пояс и NTP.

### Интеграция и визуализация

* `vnStat` умеет JSON-вывод для интеграции с графическими панелями (Grafana через exporter).
* Есть фронтенды (vnStat PHP/HTML) для веб-отчётов.

### Практические советы

* Инициализируйте БД сразу после настройки интерфейсов.
* Делайте регулярный бэкап `/var/lib/vnstat/`.
* Используйте `vnstat -l` для краткого live-проверочного измерения, затем `vnstat -d/-m` для отчёта.
* Если нужен per-flow — дополняйте `vnStat` `iftop`/`nethogs`/`sFlow`/NetFlow.

### Короткие экзаменационные тезисы

1. `vnStat` собирает и хранит агрегированную статистику интерфейсов без захвата пакетов.
2. Низкая нагрузка, хранение дневных/месячных/часовых агрегатов.
3. БД в `/var/lib/vnstat/`. Инициализация: `vnstat --create -i <iface>`.
4. Live: `vnstat -l`; отчёты: `-h, -d, -m`; экспорт: `--json`.

### Вопросы для самопроверки

1. Чем `vnStat` принципиально отличается от `iftop`?
2. Как инициализировать БД vnStat для нового интерфейса?
3. Где находятся файлы БД `vnStat` и как их бэкапить?
